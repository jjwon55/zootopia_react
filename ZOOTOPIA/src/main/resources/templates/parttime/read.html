<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í« ì‹œí„° ìƒì„¸</title>
    <!-- bootstrap css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Login CSS only -->
    <link rel="stylesheet" th:href="@{/assets/dist/css/header.css}">
    <link rel="stylesheet" href="/assets/dist/css/login.css">
    <link rel="stylesheet" th:href="@{/assets/dist/css/header.css}">
  <style>
    .btn {
      border: 1px solid #F27A7A;
      background-color: transparent;
      color: #F27A7A;
      border-radius: 6px;
      min-width: 60px;
    }

    .btn1 {
      border: 1px solid #F27A7A;
      background-color: #F27A7A;
      color: white;
      border-radius: 6px;
      min-width: 60px;
      min-height: 40px;
    }

    .pagination .page-item.active .page-link {
      background-color: #F27A7A;
      border-color: #F27A7A;
      color: white !important; 
    }

    .pagination .page-link {
      color: #F27A7A; /* ê¸°ë³¸ ê¸€ì”¨ ìƒ‰ìƒ */
      border: 1px solid #F27A7A;
      background-color: white;
    }

    .pagination .page-link:hover {
      background-color: #fbeaea;
      color: #F27A7A;
    }
  </style>
</head>
<body class="bg-light">
  <div th:replace="~{fragments/header :: header}"></div>

<div class="container my-5" style="width: 700px; height: 1000px;">
  <h3 class="text-center mb-5">í« ì‹œí„° ìƒì„¸ ë‚´ìš©</h3>
  
  <div class="card card-custom p-4 d-flex flex-column justify-content-evenly" style="height: auto;">
    <h5 class="mb-4 text-center text-danger-emphasis" th:text="${job.title}">í« ì‹œí„° ì œëª©</h5>
    <div class="mb-4 text-center">
      <div class="row mb-2">
        <div class="col-3 fw-bold">ì§€ì—­ :</div>
        <div class="col-9" th:text="${job.location}">ì„œìš¸ ê°•ì„œêµ¬</div>
      </div>
      <div class="row mb-2">
      <div class="col-3 fw-bold">ë‚ ì§œ :</div>
      <div class="col-9 d-flex flex-column">
        <div th:text="${#temporals.format(job.startDate, 'yyyyë…„ MMì›” ddì¼ (E)')}">
          2025ë…„ 07ì›” 25ì¼ (ê¸ˆ) ì˜¤ì „ 12:00
        </div>
        <div>
          ~
        </div>
        <div th:text="${#temporals.format(job.endDate, 'yyyyë…„ MMì›” ddì¼ (E)')}">
          2025ë…„ 07ì›” 26ì¼ (í† ) ì˜¤ì „ 12:00
        </div>
      </div>
      </div>
      <div class="row mb-2">
        <div class="col-3 fw-bold">ë³´ìˆ˜ :</div>
        <div class="col-9 text-primary fw-bold" th:text="${job.pay + 'ì›'}">10,000ì›</div>
      </div>
      <div class="row mb-2">
        <div class="col-3 fw-bold">ë³´í˜¸ì :</div>
        <div class="col-9 fw-bold text-success" th:text="${job.nickname}">happy_dog âœ…</div>
      </div>
      <div class="row">
        <div class="col-3 fw-bold">ë™ë¬¼ :</div>
        <div class="col-9" th:text="${job.petInfo}">ë§í‹°ì¦ˆ (2ì‚´, ìˆœí•¨)</div>
      </div>
    </div>
    
    <div class="bg-light p-3 rounded border flex-shrink-0 mb-3" style="max-height: 200px;">
      <strong>ìš”ì²­ ìƒì„¸</strong>
      <div th:if="${job.memo != null}" class="mt-2" th:text="${job.memo}">ìš”ì²­ ë©”ëª¨</div>
      <div th:if="${job.memo == null}" class="mt-2 text-muted">ìš”ì²­ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
  
  <!-- âœ… ë²„íŠ¼ ê·¸ë£¹: ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì¼ ê²½ìš° -->
  <div sec:authorize="isAuthenticated()" class="text-end mt-3 me-4 mb-3">

    <!-- âœ… ì‘ì„±ìì´ë©´ ìˆ˜ì •/ì‚­ì œ/ëª©ë¡ ëª¨ë‘ í‘œì‹œ -->
    <div th:if="${loginUserId == writerId}" class="d-flex justify-content-end gap-2">
      <a th:href="@{/parttime/update/{jobId}(jobId=${job.jobId})}" class="btn1" style="text-decoration: none; padding: 6px 12px;">ìˆ˜ì •</a>

      <form th:action="@{/parttime/delete/{jobId}(jobId=${job.jobId})}" method="post">
        <input type="hidden" name="_method" value="delete" />
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit" class="btn1" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
      </form>

      <a th:href="@{/parttime/list}" class="btn1" style="text-decoration: none; padding: 6px 12px;">ëª©ë¡</a>
    </div>

    <!-- âœ… ì‘ì„±ìê°€ ì•„ë‹ˆë©´ ëª©ë¡ ë²„íŠ¼ë§Œ í‘œì‹œ -->
    <div th:if="${loginUserId != writerId}">
      <a th:href="@{/parttime/list}" class="btn1" style="text-decoration: none; padding: 6px 12px;">ëª©ë¡</a>
    </div>

  </div>
</div>

<!-- âœ… ì‹ ì²­ ê²°ê³¼ ë©”ì‹œì§€ ë°•ìŠ¤: ë¡œê·¸ì¸ ì—¬ë¶€, ì‘ì„±ì ì—¬ë¶€ ê´€ê³„ì—†ì´ í•­ìƒ ì²´í¬ -->
<th:block th:if="${successMessage != null or errorMessage != null}">
  <div class="card mt-5 p-3 shadow-sm mb-1" style="max-width: 600px; margin: 0 auto;">
    
    <div class="text-center mb-3">
      <h6 class="text-secondary">
        ğŸ“ ì‹ ì²­ ì²˜ë¦¬ ê²°ê³¼ ë©”ì‹œì§€
      </h6>
    </div>

    <!-- âœ… ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ -->
    <div th:if="${successMessage}" class="alert alert-success text-center">
      <strong th:text="${successMessage}"></strong>
    </div>

    <!-- âŒ ì‹¤íŒ¨ ë©”ì‹œì§€ (ì¤‘ë³µ ì‹ ì²­ ë“±) -->
    <div th:if="${errorMessage}" class="alert alert-danger text-center">
      <strong th:text="${errorMessage}"></strong>
    </div>
  </div>
</th:block>

<!-- âœ… ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìì—ê²Œ ì•ˆë‚´ -->
<div sec:authorize="!isAuthenticated()" class="text-center mt-4">
  <a th:href="@{/login}" class="btn btn1">ğŸ” ë¡œê·¸ì¸ í›„ ì‹ ì²­í•˜ê¸°</a>
</div>

<!-- âœ… ì‹ ì²­ í¼: ë¡œê·¸ì¸ && ì‘ì„±ìê°€ ì•„ë‹ˆë©° && ì•„ì§ ì‹ ì²­ ì•ˆí•œ ì‚¬ìš©ìë§Œ -->
  <div sec:authorize="isAuthenticated()" th:if="${!isWriter and !hasApplied}" class="card p-3 shadow-sm mb-4 mt-5" style="max-width: 600px; margin: 0 auto;">
    <form th:action="@{/parttime/job/applicant/apply}" method="post">
      <input type="hidden" name="jobId" th:value="${job.jobId}" />
      <div class="form-group mb-3">
        <label for="introduction" class="form-label fw-bold">ìê¸°ì†Œê°œ</label>
        <textarea id="introduction" name="introduction" class="form-control" rows="3" required></textarea>
      </div>
      <div class="d-flex justify-content-between">
        <a th:href="@{/parttime/list}" class="btn">ì·¨ì†Œ</a>
        <button type="submit" class="btn1">ì‹ ì²­í•˜ê¸°</button>
      </div>
    </form>
  </div>


  <!-- ğŸ§‘â€ğŸ’¼ ì¼ë°˜ ì‹ ì²­ì ì „ìš©: ë‚´ ì‹ ì²­ ì •ë³´ë§Œ í‘œì‹œ -->
  <div th:if="${!isWriter and hasApplied}" class="mt-5">
    <h5 class="fw-bold mb-3">ğŸ“‹ ì§€ì›ì ëª©ë¡</h5>

    <div class="mb-2">
      <div class="border p-3 rounded" style="background-color: #fafafa; font-size: 0.9rem;">
        <div>
          <strong>ğŸ§‘â€ğŸ’¼ ë‚˜ :</strong> 
          <span th:text="${myApplication.introduction}">ë‚´ ì†Œê°œ</span>
        </div>
        <div class="mt-1">
          <strong>ğŸ“§ ì´ë©”ì¼:</strong> <span th:text="${myApplication.email}">ë‚´ ì´ë©”ì¼</span><br />
          <strong>ğŸ“± ì „í™”ë²ˆí˜¸:</strong> <span th:text="${myApplication.phone}">ë‚´ ì „í™”ë²ˆí˜¸</span>
        </div>
        <div class="text-end mt-2">
          <form th:action="@{/parttime/job/applicant/delete/{applicantId}/job/{jobId}(applicantId=${myApplication.applicantId}, jobId=${job.jobId})}" method="post">
            <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('ì‹ ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‹ ì²­ ì·¨ì†Œ</button>
          </form>
        </div>
      </div>
    </div>
  </div>


  <!-- ì „ì²´ ì§€ì›ì ëª©ë¡: ì‘ì„±ì ì „ìš© -->
<div th:if="${loginUserId == writerId}" class="mt-4">
  <h5 class="fw-bold mb-3">ğŸ“‹ ì§€ì›ì ëª©ë¡</h5>
  

  <div th:if="${#lists.isEmpty(applicants)}" class="text-muted">
    í˜„ì¬ ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤.
  </div>

  <div th:each="app : ${applicants}" class="mb-2">
  <div class="border p-3 rounded" style="background-color: #fafafa; font-size: 0.9rem;">

    <div class="d-flex justify-content-between align-items-center">
      <div>
        <div><strong>ğŸ§‘â€ğŸ’¼ ID:</strong> <span th:text="${app.userId}"></span></div>
        <div><strong>âœ</strong> <span th:text="${app.introduction}"></span></div>
      </div>

      <div class="text-end ms-3">
        <p class="text-muted mb-1" style="font-size: 0.75rem;" th:text="${#temporals.format(app.createdAt, 'yy.MM.dd HH:mm')}"></p>

        <!-- ì—°ë½ì²˜ ë³´ê¸° ë²„íŠ¼: ì‘ì„±ìì—ê²Œë§Œ ë³´ì„ -->
        <div th:if="${loginUserId == writerId}">
          <button class="btn btn-sm btn-toggle-contact mt-1" type="button"
            style="background-color: #F27A7A; color: white; border-radius: 6px; font-size: 0.75rem;"
            onclick="toggleContact(this)">
            ğŸ“ ì—°ë½ì²˜ ë³´ê¸°
          </button>
          <div class="mt-1 contact-info d-none">
            <div><strong>ğŸ“§ ì´ë©”ì¼:</strong> <span th:text="${app.email}"></span></div>
            <div><strong>ğŸ“± ì „í™”ë²ˆí˜¸:</strong> <span th:text="${app.phone}"></span></div>
          </div>
        </div>

        <!-- ë³¸ì¸ë§Œ ì·¨ì†Œ ê°€ëŠ¥ -->
        <form th:if="${user != null and user.userId == app.userId}"
              th:action="@{/parttime/job/applicant/delete/{applicantId}/job/{jobId}(applicantId=${app.applicantId}, jobId=${job.jobId})}"
              method="post">
            <button type="submit" class="btn btn-outline-danger btn-sm px-2 py-1" style="font-size: 0.75rem; border-radius: 4px;"
                  onclick="return confirm('ì •ë§ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">âŒ
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
  <nav th:if="${totalApplicantPages > 1}" class="mt-3">
  <ul class="pagination pagination-sm justify-content-center">
    <li class="page-item" th:classappend="${applicantPage == 1} ? 'disabled'">
      <a class="page-link custom-page" th:href="@{/parttime/read/{jobId}(jobId=${job.jobId}, applicantPage=${applicantPage - 1})}">ì´ì „</a>
    </li>
  
    <li class="page-item" th:each="i : ${#numbers.sequence(1, totalApplicantPages)}"
        th:classappend="${i == applicantPage} ? 'active'">
      <a class="page-link custom-page"
        th:href="@{/parttime/read/{jobId}(jobId=${job.jobId}, applicantPage=${i})}"
        th:text="${i}">1</a>
    </li>
  
    <li class="page-item" th:classappend="${applicantPage == totalApplicantPages} ? 'disabled'">
      <a class="page-link custom-page" th:href="@{/parttime/read/{jobId}(jobId=${job.jobId}, applicantPage=${applicantPage + 1})}">ë‹¤ìŒ</a>
    </li>
  </ul>
  </nav>
</div>

 
</div> <!-- container ë -->



<div th:replace="~{fragments/footer :: footer}"></div>
    <script th:src="@{/assets/dist/js/header.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>



<script th:inline="javascript">
  function checkLogin(event) {
    const isAuthenticated = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;

    if (!isAuthenticated) {
      event.preventDefault(); // í¼ ì œì¶œ ì¤‘ë‹¨
      alert("ë¡œê·¸ì¸ í›„ ì‹ ì²­í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      window.location.href = "/login"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
      return false;
    }

    return true;
  }
</script>

<script>
  function toggleContact(btn) {
    const info = btn.nextElementSibling;
    if (info.classList.contains("d-none")) {
      info.classList.remove("d-none");
      btn.textContent = "ğŸ”’ ì—°ë½ì²˜ ìˆ¨ê¸°ê¸°";
    } else {
      info.classList.add("d-none");
      btn.textContent = "ğŸ“ ì—°ë½ì²˜ ë³´ê¸°";
    }
  }
</script>

</body>
</html>