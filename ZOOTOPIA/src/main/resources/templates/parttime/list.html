<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security6">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í« ì‹œí„°</title>
    <!-- bootstrap css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Login CSS only -->
    <link rel="stylesheet" th:href="@{/assets/dist/css/header.css}">
    <link rel="stylesheet" href="/assets/dist/css/login.css">
    <link rel="stylesheet" th:href="@{/assets/dist/css/header.css}">
  <style>
  /* ê¸°ì¡´ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .btn1 {
    border: 1px solid #F27A7A;
    background-color: #F27A7A;
    color: white;
    border-radius: 6px;
    min-width: 60px;
  }

  .btn2 {
    border: 1px solid #F27A7A;
    background-color: transparent;
    color: #F27A7A;
    border-radius: 6px;
    min-width: 60px;
    min-height: 35px;
  }

  .btn2:hover {
    background-color: #f9d2d2;
  }

  .custom-page {
    color: #F27A7A !important;
    border-color: #F27A7A !important;
  }

  .page-item.active .custom-page {
    background-color: #F27A7A !important;
    color: white !important;
    border-color: #F27A7A !important;
  }

  .comment-writer {
    color: #F27A7A;
    font-weight: 600;
  }

  .comment-date {
    color: #888;
    font-size: 0.85rem;
  }

  .comment-content {
    margin-top: 8px;
    font-size: 0.95rem;
  }

  .comment-box {
    background-color: #fdfdfd;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
  }
  </style>
</head>
<body class="bg-light">
<div th:replace="~{fragments/header :: header}"></div>
<div class="container py-4" style="min-width: 1000px; min-height: 1000px;">
  <h2 class="text-center mb-5">í« ì‹œí„°</h2>
  
  <!-- í•„í„°ë§ í¼ -->
<form method="get" action="/parttime/list"
      class="d-flex flex-wrap justify-content-center align-items-center gap-2 p-3 rounded shadow-sm"
      style="background-color: #ffecec; max-width: 900px; margin: 0 auto;">

  <!-- ì§€ì—­ -->
  <div class="d-flex align-items-center gap-2">
    <i class="bi bi-geo-alt-fill text-danger"></i>
    <select class="form-select form-select-sm" name="location" style="width: 150px;"
            onchange="this.form.submit()">
      <option value="">ì§€ì—­ ì„ íƒ</option>
      <option value="ì„œìš¸" th:selected="${location eq 'ì„œìš¸'}">ì„œìš¸</option>
      <option value="ê²½ê¸°" th:selected="${location eq 'ê²½ê¸°'}">ê²½ê¸°</option>
      <option value="ì¸ì²œ" th:selected="${location eq 'ì¸ì²œ'}">ì¸ì²œ</option>
      <option value="ë¶€ì‚°" th:selected="${location eq 'ë¶€ì‚°'}">ë¶€ì‚°</option>
      <option value="ëŒ€ì „" th:selected="${location eq 'ëŒ€ì „'}">ëŒ€ì „</option>
      <option value="ëŒ€êµ¬" th:selected="${location eq 'ëŒ€êµ¬'}">ëŒ€êµ¬</option>
      <option value="ëª©í¬" th:selected="${location eq 'ëª©í¬'}">ëª©í¬</option>
    </select>
  </div>

  <!-- ë™ë¬¼ ì¢…ë¥˜ -->
  <div class="d-flex align-items-center gap-2">
    ğŸ¾
    <select class="form-select form-select-sm" name="animalType" style="width: 150px;"
            onchange="this.form.submit()">
      <option value="">ë™ë¬¼ ì¢…ë¥˜</option>
      <option value="í¬ìœ ë¥˜" th:selected="${animalType eq 'í¬ìœ ë¥˜'}">í¬ìœ ë¥˜</option>
      <option value="íŒŒì¶©ë¥˜" th:selected="${animalType eq 'íŒŒì¶©ë¥˜'}">íŒŒì¶©ë¥˜</option>
      <option value="ì ˆì§€ë¥˜" th:selected="${animalType eq 'ì ˆì§€ë¥˜'}">ì ˆì§€ë¥˜</option>
      <option value="ì–‘ì„œë¥˜" th:selected="${animalType eq 'ì–‘ì„œë¥˜'}">ì–‘ì„œë¥˜</option>
      <option value="ì–´ë¥˜" th:selected="${animalType eq 'ì–´ë¥˜'}">ì–´ë¥˜</option>
      <option value="ì¡°ë¥˜" th:selected="${animalType eq 'ì¡°ë¥˜'}">ì¡°ë¥˜</option>
    </select>
  </div>

  <!-- ë³´ìˆ˜ -->
  <div class="d-flex align-items-center gap-2">
    <i class="bi bi-cash-coin text-success"></i>
    <select class="form-select form-select-sm" name="payRange" style="width: 130px;"
            onchange="this.form.submit()">
      <option value="">ë³´ìˆ˜</option>
      <option value="low" th:selected="${payRange eq 'low'}">1ë§Œì› ë¯¸ë§Œ</option>
      <option value="mid" th:selected="${payRange eq 'mid'}">1~2ë§Œì› ì‚¬ì´</option>
      <option value="high" th:selected="${payRange eq 'high'}">2ë§Œì› ì´ìƒ</option>
    </select>
  </div>

  <!-- ë‚ ì§œ -->
  <div class="d-flex align-items-center gap-2">
    <i class="bi bi-calendar-event text-primary"></i>
    <input type="date" name="startDate" class="form-control form-control-sm"
           style="width: 140px;" th:value="${startDate}" onchange="this.form.submit()" />
    <span>~</span>
    <input type="date" name="endDate" class="form-control form-control-sm"
           style="width: 140px;" th:value="${endDate}" onchange="this.form.submit()" />
  </div>

  <!-- í‚¤ì›Œë“œ -->
  <div class="input-group input-group-sm mt-2" style="width: 250px;">
    <input type="text" class="form-control" name="keyword" th:value="${keyword}" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" />
    <button class="btn btn-outline-secondary" type="submit">
      <i class="bi bi-search"></i>
    </button>
  </div>
</form>

  
  <!-- ì¹´ë“œ ê·¸ë¦¬ë“œ -->
    <div class="container rounded shadow-sm mt-3 mb-3 p-1" style="max-width: 1000px;">

    <div class="row justify-content-center mt-5 mb-5">
      <div class="col-md-5 d-flex justify-content-center align-items-center" th:each="job : ${jobs}">
        <div class="card border-0 shadow-sm rounded p-3 mt-5 mb-2" style="background-color: #f8fbe9; width: 85%; min-width: 300px;">
          <h6 class="fw-bold mb-4">ğŸ¾ <span th:text="${job.title}">ì œëª©</span></h6>
          <p class="mb-1">ğŸ“ <span th:text="${job.location}">ì§€ì—­</span></p>
          <p class="mb-1">ğŸ—“ï¸ <span th:text="${job.startDate}">2025-07-01</span> ~
                             <span th:text="${job.endDate}">2025-07-03</span></p>
          <p class="mb-1">ğŸ’° <span th:text="${job.pay}">10000</span>ì›</p>
          <p class="mb-1">ğŸ‘¤ ë³´í˜¸ì: <span th:text="${job.nickname}">happy.dog</span></p>
          <div class="d-flex justify-content-end gap-2 mt-2">
            <a th:href="@{/parttime/read/{jobId}(jobId=${job.jobId})}" class="btn btn-outline-secondary btn-sm">ìƒì„¸ë³´ê¸°</a>
          </div>
        </div>
      </div>
    </div>

<!-- ğŸ”½ ì•„ë¥´ë°”ì´íŠ¸ ì¹´ë“œ í•˜ë‹¨ í˜ì´ì§€ë„¤ì´ì…˜ -->
<div class="text-center mt-4">
  <nav>
    <ul class="pagination justify-content-center">
      
      <!-- ì´ì „ í˜ì´ì§€ ë²„íŠ¼ -->
      <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
        <a class="page-link custom-page"
           th:href="@{'/parttime/list?page=' + (${currentPage} - 1)
                     + '&location=' + ${location}
                     + '&animalType=' + ${animalType}
                     + '&payRange=' + ${payRange}
                     + '&startDate=' + ${startDate}
                     + '&endDate=' + ${endDate}
                     + '&keyword=' + ${keyword}
                     + '&commentPage=' + ${commentPage}}">ì´ì „</a>
      </li>
      <!-- í˜ì´ì§€ ë²ˆí˜¸ ë°˜ë³µ -->
      <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
          th:classappend="${i == currentPage} ? 'active'">
        <a class="page-link custom-page"
           th:href="@{'/parttime/list?page=' + ${i}
                     + '&location=' + ${location}
                     + '&animalType=' + ${animalType}
                     + '&payRange=' + ${payRange}
                     + '&startDate=' + ${startDate}
                     + '&endDate=' + ${endDate}
                     + '&keyword=' + ${keyword}
                     + '&commentPage=' + ${commentPage}}"
           th:text="${i}">1</a>
      </li>
      <!-- ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ -->
      <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
        <a class="page-link custom-page"
           th:href="@{'/parttime/list?page=' + (${currentPage} + 1)
                     + '&location=' + ${location}
                     + '&animalType=' + ${animalType}
                     + '&payRange=' + ${payRange}
                     + '&startDate=' + ${startDate}
                     + '&endDate=' + ${endDate}
                     + '&keyword=' + ${keyword}
                     + '&commentPage=' + ${commentPage}}">ë‹¤ìŒ</a>
      </li>
    </ul>
  </nav>
</div>

    <!-- ë“±ë¡ ë²„íŠ¼ -->
    <div class="text-end mb-5 me-4">
      <a href="/parttime/create" class="btn1 btn-sm" style="text-decoration: none; padding: 6px 12px;">ë“±ë¡í•˜ê¸°</a>
    </div>

  </div>

  <!-- ë¦¬ë·° ì˜ì—­ ì‹œì‘ -->
<div class="row justify-content-center my-5">
  <div class="col-md-8 bg-light border rounded p-3">
    <h5 class="fw-bold mb-3 text-center">âœï¸ ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”</h5>

      <!-- âœ… ì™¼ìª½ ìƒë‹¨ ëŒ“ê¸€ ê°œìˆ˜ -->
    <div id="comment-count" class="mb-3 text-start">
      <span class="fw-bold">ğŸ’¬ ëŒ“ê¸€</span> <span th:text="${totalComments}">0</span>ê°œ
    </div>


    <!-- âœ… ëŒ“ê¸€ ëª©ë¡ ì¶œë ¥ (ì„œë²„ ë Œë”ë§) -->
    
      <div th:each="comment : ${comments}" class="comment-box mb-3">
        <div class="d-flex justify-content-between small">
          <span class="comment-writer" th:text="${comment.writer}">ì‘ì„±ì</span>
          <span class="comment-date" th:text="${#temporals.format(comment.createdAt, 'yyyy.MM.dd HH:mm')}">ë‚ ì§œ</span>
        </div>
        <p class="comment-content mb-1" th:text="${comment.content}">ë‚´ìš©</p>

          <!-- âœ… ë³¸ì¸ ëŒ“ê¸€ì¼ ë•Œë§Œ ì‚­ì œ ë²„íŠ¼ -->
        <div class="text-end mt-2" th:if="${user != null and user.userId == comment.userId}">
          <form th:action="@{/parttime/job/comment/delete/{commentId}(commentId=${comment.commentId})}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="btn2 btn-sm" style="padding: 2px 8px; font-size: 0.75rem; line-height: 1; height: auto;" onclick="return confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
          </form>
        </div>
      </div>
    
      <!-- âœ… ğŸ”½ ëŒ“ê¸€ í˜ì´ì§€ë„¤ì´ì…˜  -->
    <div class="text-center mt-4">
      <nav>
        <ul class="pagination pagination-sm justify-content-center">

          <!-- ì´ì „ ë²„íŠ¼ -->
          <li class="page-item" th:classappend="${commentPage == 1} ? 'disabled'">
            <a class="page-link custom-page"
              th:href="'/parttime/list?page=' + ${currentPage} + '&commentPage=' + (${commentPage - 1})">ì´ì „</a>
          </li>

          <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
          <li class="page-item" th:each="i : ${#numbers.sequence(1, totalCommentPages)}"
              th:classappend="${i == commentPage} ? 'active'">
            <a class="page-link custom-page"
              th:href="'/parttime/list?page=' + ${currentPage} + '&commentPage=' + ${i}"
              th:text="${i}">1</a>
          </li>

          <!-- ë‹¤ìŒ ë²„íŠ¼ -->
          <li class="page-item" th:classappend="${commentPage == totalCommentPages} ? 'disabled'">
            <a class="page-link custom-page"
              th:href="'/parttime/list?page=' + ${currentPage} + '&commentPage=' + (${commentPage + 1})">ë‹¤ìŒ</a>
          </li>

        </ul>
      </nav>
    </div>

  <!-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ëŒ“ê¸€ ì‘ì„± ê°€ëŠ¥ -->
<div class="mt-1" 
     sec:authorize="isAuthenticated() and (hasRole('USER') or hasRole('ADMIN'))">
  <form action="/parttime/job/comment/register" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <input type="hidden" name="writer" th:value="${user.nickname}" />
    <div class="mb-2">
      <textarea name="content" class="form-control" rows="3"
                placeholder="ììœ ë¡­ê²Œ ìƒê° ë‚¨ê²¨ì£¼ì„¸ìš”" required></textarea>
    </div>
    <div class="text-end mt-2">
      <button type="submit" class="btn1">ë‚¨ê¸°ê¸°</button>
    </div>
  </form>
</div>

  <!-- ë¡œê·¸ì¸ ì•ˆ í•œ ì‚¬ìš©ìì—ê²Œ ê²½ê³  í‘œì‹œ -->
  <div th:if="${user == null}">
    <div class="alert alert-warning mt-3">
      ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ <a href="/login">ë¡œê·¸ì¸</a>ì´ í•„ìš”í•©ë‹ˆë‹¤.
    </div>
  </div>

  </div>
</div> <!-- ë¦¬ë·° ì˜ì—­ ë -->

</div>

<div th:replace="~{fragments/footer :: footer}"></div>

    <script th:src="@{/assets/dist/js/header.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
  

</body>
</html>